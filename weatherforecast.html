<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Weather Forecast — Neon Sky</title>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
	<meta name="color-scheme" content="light dark">
	<style>
		:root{
			--bg1:#0f1724; --bg2:#071028;
			--glass: rgba(255,255,255,0.04);
			--accent:#00e0ff; --accent2:#7b61ff; --card:#0b1220;
			--muted:rgba(255,255,255,0.7);
			--glass-2: rgba(255,255,255,0.03);
		}
		*{box-sizing:border-box}
		html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; background:linear-gradient(135deg,var(--bg1),var(--bg2));color:#e6f6ff}
		.wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:36px}
		.app{width:100%;max-width:1000px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:18px;padding:24px;position:relative;overflow:hidden;box-shadow:0 8px 40px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
		.top{display:flex;align-items:center;gap:18px}
		.logo{display:flex;flex-direction:column;gap:6px}
		.title{font-family:Poppins,Inter;font-size:20px;letter-spacing:0.4px}
		.subtitle{color:var(--muted);font-size:12px}
		.search{margin-left:auto;display:flex;gap:8px;align-items:center}
		.search input[type=text]{background:var(--glass);border:1px solid var(--glass-2);padding:10px 12px;border-radius:10px;color:inherit;min-width:220px}
		.btn{background:linear-gradient(90deg,var(--accent),var(--accent2));padding:10px 12px;border-radius:10px;color:#021224;font-weight:600;border:none;cursor:pointer}
		.controls{display:flex;gap:8px;align-items:center}
		.small{font-size:12px;color:var(--muted)}

		.content{display:grid;grid-template-columns:1fr 380px;gap:18px;margin-top:20px}
		.main-card{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:18px;border-radius:14px;border:1px solid rgba(255,255,255,0.02)}
		.current{display:flex;gap:18px;align-items:center}
		.temp{font-size:56px;font-weight:800;line-height:1}
		.cond{color:var(--muted)}
		.meta{display:flex;gap:12px;margin-top:12px;color:var(--muted);font-size:13px}

		.forecast{display:flex;gap:10px;margin-top:18px;overflow:auto;padding-bottom:6px}
		.fc-card{min-width:110px;background:rgba(255,255,255,0.02);padding:10px;border-radius:10px;text-align:center;border:1px solid rgba(255,255,255,0.015)}
		.fc-card .day{font-weight:700}

		.side{display:flex;flex-direction:column;gap:12px}
		.panel{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.02)}
		.apikey{display:flex;gap:8px;align-items:center}
		.apikey input{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit}
		.muted{Color:var(--muted);font-size:13px}

		.bg-orn{position:absolute;right:-120px;top:-120px;opacity:0.12;filter:blur(12px);transform:rotate(20deg)}

		/* small screens */
		@media (max-width:920px){
			.content{grid-template-columns:1fr;}
			.search input{min-width:140px}
			.temp{font-size:44px}
		}

		/* nice little animations */
		.sun{width:82px;height:82px;border-radius:50%;background:conic-gradient(from 120deg,#ffd36b,#ff8a00 60%,#ff5e5e 100%);display:flex;align-items:center;justify-content:center;box-shadow:0 8px 24px rgba(255,160,60,0.12);animation:float 6s ease-in-out infinite}
		@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}

		.hint{font-size:13px;color:var(--muted);margin-top:8px}
	</style>
</head>
<body>
	<div class="wrap">
		<div class="app" role="application" aria-label="Weather Forecast">
			<svg class="bg-orn" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="g1" x1="0" x2="1"><stop offset="0" stop-color="#00e0ff"/><stop offset="1" stop-color="#7b61ff"/></linearGradient></defs><circle cx="100" cy="100" r="90" fill="url(#g1)" /></svg>

			<div class="top">
				<div class="logo">
					<div class="title">Neon Sky</div>
					<div class="subtitle">Accurate · Responsive · Stylish</div>
				</div>

				<div class="search" aria-label="Search and controls">
					<input id="cityInput" type="text" placeholder="Enter city (e.g. London)" aria-label="City name" />
					<div class="controls">
						<button id="searchBtn" class="btn">Search</button>
						<button id="locBtn" class="btn" title="Use your location">Use Location</button>
					</div>
				</div>
			</div>

			<div class="content">
				<div class="main-card">
					<div class="current">
						<div class="sun" id="weatherIcon" title="weather icon"></div>
						<div>
							<div style="display:flex;align-items:baseline;gap:12px"><div class="temp" id="temp">--°</div><div class="cond" id="condition">—</div></div>
							<div class="meta" id="meta">
								<div id="location">Unknown</div>
								<div id="feels">Feels: --°</div>
								<div id="hum">Humidity: --%</div>
							</div>
							<div class="hint" id="updateHint">Enter a city or allow location. Save your API key in the side panel.</div>
						</div>
					</div>

					<div class="forecast" id="forecast" aria-live="polite"></div>
				</div>

				<div class="side">
					<div class="panel apikey">
						<div style="font-weight:700">API Key</div>
						<input id="apiKey" placeholder="OpenWeatherMap API Key (optional)" />
						<button id="saveKey" class="btn">Save</button>
					</div>

					<div class="panel">
						<div style="display:flex;justify-content:space-between;align-items:center"><div style="font-weight:700">Settings</div><div class="small muted">Units</div></div>
						<div style="display:flex;gap:8px;margin-top:8px">
							<button id="unitC" class="btn">°C</button>
							<button id="unitF" class="btn">°F</button>
						</div>
						<div class="muted" style="margin-top:10px">Tip: Save your API key to get live data. If none provided, demo data will be used.</div>
					</div>

					<div class="panel">
						<div style="font-weight:700">About</div>
						<div class="muted" style="margin-top:8px">Neon Sky uses OpenWeatherMap (you'll need an API key). It shows current conditions and a 5-day forecast.</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>
		// Minimal, clear weather app using OpenWeatherMap
		const apiKeyInput = document.getElementById('apiKey');
		const saveKeyBtn = document.getElementById('saveKey');
		const searchBtn = document.getElementById('searchBtn');
		const cityInput = document.getElementById('cityInput');
		const locBtn = document.getElementById('locBtn');
		const unitC = document.getElementById('unitC');
		const unitF = document.getElementById('unitF');

		const tempEl = document.getElementById('temp');
		const conditionEl = document.getElementById('condition');
		const locationEl = document.getElementById('location');
		const feelsEl = document.getElementById('feels');
		const humEl = document.getElementById('hum');
		const forecastEl = document.getElementById('forecast');
		const updateHint = document.getElementById('updateHint');
		const weatherIcon = document.getElementById('weatherIcon');

		const STORAGE_KEY = 'neonsky_api_key';
		const STORAGE_UNITS = 'neonsky_units';

		// sample demo data to use when no API key
		const demo = {
			current:{temp:22, feels_like:21, humidity:56, weather:[{main:'Clouds',description:'broken clouds',icon:'04d'}],name:'Demo City'},
			daily:[{dt_txt:'Today',temp:{min:18,max:24},weather:[{icon:'04d'}]},{dt_txt:'Tomorrow',temp:{min:16,max:23},weather:[{icon:'03d'}]},{dt_txt:'Day 3',temp:{min:15,max:22},weather:[{icon:'10d'}]},{dt_txt:'Day 4',temp:{min:14,max:21},weather:[{icon:'01d'}]},{dt_txt:'Day 5',temp:{min:13,max:20},weather:[{icon:'02d'}]}]
		};

		function loadSettings(){
			const k = localStorage.getItem(STORAGE_KEY) || '';
			apiKeyInput.value = k;
			const u = localStorage.getItem(STORAGE_UNITS) || 'metric';
			setUnits(u);
		}

		function setUnits(u){
			localStorage.setItem(STORAGE_UNITS, u);
			if(u==='metric'){unitC.style.opacity=1;unitF.style.opacity=0.6;}else{unitF.style.opacity=1;unitC.style.opacity=0.6}
		}

		saveKeyBtn.addEventListener('click', ()=>{
			localStorage.setItem(STORAGE_KEY, apiKeyInput.value.trim());
			updateHint.textContent = 'API key saved. Searching will show live data.';
		});

		unitC.addEventListener('click', ()=>{setUnits('metric'); if(lastQuery) runQuery(lastQuery)});
		unitF.addEventListener('click', ()=>{setUnits('imperial'); if(lastQuery) runQuery(lastQuery)});

		searchBtn.addEventListener('click', ()=>{const q = cityInput.value.trim(); if(!q) return alert('Enter a city name'); runQuery({type:'q',value:q});});
		cityInput.addEventListener('keydown', (e)=>{if(e.key==='Enter'){searchBtn.click()}});

		locBtn.addEventListener('click', ()=>{ if(!navigator.geolocation) return alert('Geolocation not supported'); navigator.geolocation.getCurrentPosition(pos=>{runQuery({type:'coords',value:pos.coords})},err=>{alert('Location denied or unavailable')})});

		let lastQuery = null;

		async function runQuery(q){
			lastQuery = q;
			const key = localStorage.getItem(STORAGE_KEY) || '';
			const units = localStorage.getItem(STORAGE_UNITS) || 'metric';
			updateHint.textContent = 'Loading...';

			if(!key){
				renderAll(demo, units);
				updateHint.textContent = 'Demo data shown — save an API key for live data.';
				return;
			}

			try{
				let currentUrl, forecastUrl;
				if(q.type==='q'){
					const city = encodeURIComponent(q.value);
					currentUrl = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${key}&units=${units}`;
					forecastUrl = `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${key}&units=${units}`;
				}else{
					const {latitude,longitude} = q.value;
					currentUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&appid=${key}&units=${units}`;
					forecastUrl = `https://api.openweathermap.org/data/2.5/forecast?lat=${latitude}&lon=${longitude}&appid=${key}&units=${units}`;
				}

				const [cRes,fRes] = await Promise.all([fetch(currentUrl), fetch(forecastUrl)]);
				if(!cRes.ok || !fRes.ok){
					const text = await cRes.text().catch(()=>null);
					updateHint.textContent = 'Error fetching live data — check API key and city.';
					renderAll(demo, units);
					return;
				}
				const cData = await cRes.json();
				const fData = await fRes.json();
				// build simple combined object
				const combined = {current:cData, forecast:fData};
				renderAll(combined, units);
				updateHint.textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
			}catch(err){
				console.error(err);
				updateHint.textContent = 'Network error — showing demo data.';
				renderAll(demo, localStorage.getItem(STORAGE_UNITS)||'metric');
			}
		}

		function renderAll(data, units){
			// current
			const cur = data.current;
			const t = cur.temp ?? cur.main?.temp ?? '--';
			tempEl.textContent = Math.round(t)+ (units==='metric' ? '°C' : '°F');
			conditionEl.textContent = (cur.weather && cur.weather[0] && cur.weather[0].main) || cur.weather?.[0]?.description || '—';
			locationEl.textContent = cur.name || (cur.sys && cur.sys.country ? `${cur.name}, ${cur.sys.country}` : 'Unknown');
			feelsEl.textContent = 'Feels: ' + (Math.round(cur.feels_like ?? cur.main?.feels_like ?? '--')) + (units==='metric'?'°C':'°F');
			humEl.textContent = 'Humidity: ' + (cur.humidity ?? cur.main?.humidity ?? '--') + '%';

			// icon
			const icon = (cur.weather && cur.weather[0] && cur.weather[0].icon) || (cur.weather && cur.weather[0] && cur.weather[0].icon) || '01d';
			setIcon(icon);

			// forecast: if we have fData from API, it's in data.forecast.list (3h steps)
			const daily = getDailyFromForecast(data.forecast);
			renderForecast(daily, units);
		}

		function setIcon(icon){
			// use OpenWeatherMap icon as background of sun element for style
			const url = `https://openweathermap.org/img/wn/${icon}@2x.png`;
			weatherIcon.style.backgroundImage = `url(${url})`;
			weatherIcon.style.backgroundSize = 'contain';
			weatherIcon.style.backgroundRepeat = 'no-repeat';
			weatherIcon.style.backgroundPosition = 'center';
		}

		function getDailyFromForecast(forecast){
			if(!forecast) return demo.daily;
			// forecast.list has 3-hour entries with dt_txt. We'll aggregate into days and pick midday or average.
			const map = new Map();
			for(const item of (forecast.list || [])){
				const d = item.dt_txt.split(' ')[0];
				if(!map.has(d)) map.set(d, []);
				map.get(d).push(item);
			}
			const days = [];
			for(const [day,items] of map.entries()){
				// compute min/max
				let min=Infinity,max=-Infinity; let icon = items[0].weather[0].icon;
				for(const it of items){ min = Math.min(min, it.main.temp_min); max = Math.max(max, it.main.temp_max); }
				days.push({dt_txt: day, temp:{min, max}, weather:[{icon}]});
			}
			// return next 5 days
			return days.slice(0,5);
		}

		function renderForecast(days, units){
			forecastEl.innerHTML = '';
			for(const d of days){
				const el = document.createElement('div'); el.className='fc-card';
				const dayLabel = d.dt_txt === 'Today' ? 'Today' : formatDay(d.dt_txt);
				const icon = d.weather?.[0]?.icon || '01d';
				el.innerHTML = `<div class="day">${dayLabel}</div><img src="https://openweathermap.org/img/wn/${icon}@2x.png" alt="icon" style="width:64px;height:64px"><div style="margin-top:6px;font-weight:700">${Math.round(d.temp.max)}${units==='metric'?'°C':'°F'}</div><div class="muted">${Math.round(d.temp.min)}${units==='metric'?'°C':'°F'}</div>`;
				forecastEl.appendChild(el);
			}
		}

		function formatDay(text){
			// if ISO date, convert to weekday
			try{ const dt = new Date(text); return dt.toLocaleDateString(undefined,{weekday:'short'});}catch(e){return text}
		}

		// initial
		loadSettings();

		// helpful demo search
		cityInput.value = 'New York';
		// run a quick demo search if API key present
		if(localStorage.getItem(STORAGE_KEY)){
			runQuery({type:'q',value:cityInput.value});
		}else{
			renderAll(demo, localStorage.getItem(STORAGE_UNITS)||'metric');
		}
	</script>
</body>
</html>
